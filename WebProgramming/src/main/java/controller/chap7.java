package controller;import data.UserIO;import java.io.IOException;import javax.servlet.ServletContext;import javax.servlet.ServletException;import javax.servlet.ServletRequest;import javax.servlet.ServletResponse;import javax.servlet.annotation.WebServlet;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import model.User;import util.CookieUtil;@WebServlet({"/api/chap7/*"})public class chap7 extends HttpServlet {  private static final long serialVersionUID = 1L;    public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {    String action = request.getParameter("action");    if (action == null)      action = "viewAlbums";     String url = "/index.jsp";    if (action.equals("viewAlbums")) {      url = "/pages/c7e1/index.jsp";    } else if (action.equals("checkUser")) {      url = checkUser(request, response);    } else if (action.equals("viewCookies")) {      url = "/pages/c7e1/view_cookies.jsp";    } else if (action.equals("deleteCookies")) {      url = deleteCookies(request, response);    }     getServletContext().getRequestDispatcher(url).forward((ServletRequest)request, (ServletResponse)response);  }    public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException, ServletException {    String action = request.getParameter("action");    String url = "/index.jsp";    if (action.equals("registerUser"))      url = registerUser(request, response);     getServletContext().getRequestDispatcher(url).forward((ServletRequest)request, (ServletResponse)response);  }    private String checkUser(HttpServletRequest request, HttpServletResponse response) {    String url, productCode = request.getParameter("productCode");    HttpSession session = request.getSession();    session.setAttribute("productCode", productCode);    User user = (User)session.getAttribute("user");    if (user == null) {      Cookie[] cookies = request.getCookies();      String emailAddress = CookieUtil.getCookieValue(cookies, "emailCookie");      if (emailAddress == null || emailAddress.equals("")) {        url = "/pages/c7e1/register.jsp";      } else {        ServletContext sc = getServletContext();        String path = sc.getRealPath("/WEB-INF/EmailList.txt");        user = UserIO.getUser(emailAddress, path);        session.setAttribute("user", user);        url = "/pages/c7e1/" + productCode + "_download.jsp";      }     } else {      url = "/pages/c7e1/" + productCode + "_download.jsp";    }     return url;  }    private String registerUser(HttpServletRequest request, HttpServletResponse response) {    String email = request.getParameter("email");    String firstName = request.getParameter("firstName");    String lastName = request.getParameter("lastName");    User user = new User();    user.setEmail(email);    user.setFirstName(firstName);    user.setLastName(lastName);    ServletContext sc = getServletContext();    String path = sc.getRealPath("/WEB-INF/EmailList.txt");    UserIO.add(user, path);    HttpSession session = request.getSession();    session.setAttribute("user", user);    Cookie c = new Cookie("userEmail", email);    c.setMaxAge(94608000);    c.setPath("/");    response.addCookie(c);    String productCode = (String)session.getAttribute("productCode");    String url = "/pages/c7e1/" + productCode + "_download.jsp";    return url;  }    private String deleteCookies(HttpServletRequest request, HttpServletResponse response) {    Cookie[] cookies = request.getCookies();    if (cookies != null) {      byte b;      int i;      Cookie[] arrayOfCookie;      for (i = (arrayOfCookie = cookies).length, b = 0; b < i; ) {        Cookie cookie = arrayOfCookie[b];        cookie.setMaxAge(0);        cookie.setPath("/");        response.addCookie(cookie);        b++;      }     }     String url = "/pages/c7e1/delete_cookies.jsp";    return url;  }}